<?php
date_default_timezone_set('Atlantic/Reykjavik');

// When was the company formed?
$epoch   = strtotime('2011-02-07');

// Which quarter do you want the A5 book for?
$year    = 2015;
$quarter = 3;

// Figure out how many week since the company's first week.
$month = ($quarter*3)-2;
$start_date = strtotime($year.'-'.$month.'-01');

$epoch_week_padding = date('w',$epoch)-1;
$week_padding       = date('w',$start_date)-1;

$time_diff = $start_date - $epoch;
$days_diff = $time_diff/(24*60*60);

$days_diff_padding = ($days_diff + $epoch_week_padding - $week_padding);
$week_number = $days_diff_padding/7;



for($i=0;$i<13;$i++){
	$svg = '';
	$monday = $start_date - ($week_padding*(24*60*60));


	$svg .= '<?xml version="1.0" standalone="no"?>
	<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">'."\n";

	$svg .=  '<svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="297mm" height="210mm" >'."\n";

	// Front page for the week:
	$svg .= '<text x="9.886mm" y="21.638mm" font-family="\'Futura-Medium\'" font-size="48">#'.$week_number.'</text>';

	$svg .= '<text text-anchor="start" fill="#B2B2B2" y="22mm" x="75mm" font-family="\'Futura-Medium\'" font-size="12">Q'.$quarter.' WEEK '.date('W',$monday).'</text>';
	$svg .= '<text text-anchor="end"   fill="#B2B2B2" y="22mm" x="135.7mm" font-family="\'Futura-Medium\'" font-size="12">'.date('d/m',$monday).' - '.date('d/m',strtotime('+6 days',$monday)).'</text>';

	$svg .= makeWeek($monday);


	// Backpage lines
	$margin = 12;
	$lines = 17;
	for($j=0;$j<$lines;$j++){
		$y = $margin + $j*((210-$margin)/$lines);
		if ($j != 16){
			$svg .= '<line x1="159.688mm" x2="287.8mm" y1="'.$y.'mm" y2="'.$y.'mm" fill="none" stroke="#B2B2B2" stroke-width="0.25" stroke-miterlimit="10" />';			
		}
	}

	// Footer
	$svg .= '<text text-anchor="start" fill="#B2B2B2" y="200mm" x="160mm" font-family="\'Futura-Medium\'" font-size="12">#WEEKNOTES</text>';

	// Logo
	$svg .= '<line fill="none" stroke="#B2B2B2" stroke-width="0.25" stroke-miterlimit="10" x1="537.445" y1="562.188" x2="750.445" y2="562.188"/>
	<ellipse fill="#FFFFFF" cx="634.685" cy="561.895" rx="7.304" ry="12.438"/>
	<g>
		<path fill="#B2B2B2" d="M756.812,561.999c0-0.982,0.352-1.82,1.056-2.508c0.701-0.689,1.559-1.035,2.57-1.035
			c1.015,0,1.875,0.348,2.584,1.043c0.697,0.691,1.047,1.545,1.047,2.555c0,1.02-0.35,1.875-1.054,2.564
			c-0.709,0.684-1.578,1.025-2.606,1.025c-1.02,0-1.874-0.348-2.563-1.047C757.156,563.907,756.812,563.042,756.812,561.999z
			 M758.419,562.026c0,0.68,0.181,1.217,0.544,1.613c0.374,0.4,0.863,0.602,1.476,0.602c0.613,0,1.105-0.197,1.474-0.594
			c0.367-0.396,0.552-0.926,0.552-1.586c0-0.662-0.185-1.191-0.552-1.586c-0.374-0.4-0.864-0.602-1.474-0.602
			c-0.603,0-1.089,0.201-1.461,0.602C758.604,560.876,758.419,561.394,758.419,562.026z"/>
		<path fill="#B2B2B2" d="M766.41,569.151h-1.572v-10.506h1.572v0.74c0.619-0.619,1.321-0.93,2.109-0.93
			c0.936,0,1.706,0.346,2.312,1.035c0.614,0.684,0.922,1.547,0.922,2.592c0,1.02-0.304,1.869-0.914,2.547
			c-0.605,0.678-1.369,1.014-2.291,1.014c-0.797,0-1.508-0.318-2.138-0.957V569.151z M770.148,562.089
			c0-0.652-0.18-1.184-0.532-1.594c-0.358-0.412-0.811-0.621-1.356-0.621c-0.577,0-1.045,0.201-1.402,0.602
			c-0.358,0.4-0.539,0.926-0.539,1.578c0,0.639,0.181,1.164,0.539,1.58c0.354,0.404,0.819,0.607,1.396,0.607
			c0.545,0,0.994-0.205,1.349-0.615C769.965,563.216,770.148,562.704,770.148,562.089z"/>
		<path fill="#B2B2B2" d="M774.445,560.112v5.336h-1.57v-5.336h-0.67v-1.467h0.67v-2.494h1.57v2.494h0.687v1.467H774.445z"/>
		<path fill="#B2B2B2" d="M775.785,556.175c0-0.277,0.1-0.514,0.301-0.713c0.199-0.199,0.439-0.301,0.72-0.301
			c0.284,0,0.525,0.102,0.726,0.301c0.2,0.195,0.301,0.434,0.301,0.719s-0.101,0.525-0.301,0.727
			c-0.194,0.201-0.436,0.301-0.72,0.301s-0.526-0.1-0.726-0.301C775.885,556.706,775.785,556.462,775.785,556.175z M777.595,558.646
			v6.803h-1.573v-6.803H777.595z"/>
		<path fill="#B2B2B2" d="M778.369,561.999c0-0.982,0.353-1.82,1.056-2.508c0.702-0.689,1.562-1.035,2.569-1.035
			c1.017,0,1.879,0.348,2.586,1.043c0.697,0.691,1.048,1.545,1.048,2.555c0,1.02-0.353,1.875-1.055,2.564
			c-0.708,0.684-1.576,1.025-2.605,1.025c-1.02,0-1.875-0.348-2.565-1.047C778.715,563.907,778.369,563.042,778.369,561.999z
			 M779.977,562.026c0,0.68,0.182,1.217,0.544,1.613c0.373,0.4,0.865,0.602,1.474,0.602c0.615,0,1.106-0.197,1.476-0.594
			c0.367-0.396,0.55-0.926,0.55-1.586c0-0.662-0.183-1.191-0.55-1.586c-0.373-0.4-0.865-0.602-1.476-0.602
			c-0.599,0-1.086,0.201-1.459,0.602S779.977,561.394,779.977,562.026z"/>
		<path fill="#B2B2B2" d="M786.396,558.646h1.578v0.629c0.55-0.547,1.168-0.818,1.859-0.818c0.79,0,1.406,0.25,1.85,0.748
			c0.382,0.424,0.572,1.115,0.572,2.074v4.17h-1.578v-3.795c0-0.67-0.094-1.133-0.28-1.389c-0.181-0.258-0.512-0.391-0.991-0.391
			c-0.522,0-0.893,0.174-1.109,0.518c-0.216,0.338-0.322,0.932-0.322,1.777v3.279h-1.578V558.646z"/>
		<path fill="#B2B2B2" d="M798.361,558.646h1.579v6.803h-1.579v-0.711c-0.647,0.605-1.344,0.906-2.089,0.906
			c-0.94,0-1.718-0.338-2.333-1.02c-0.61-0.693-0.915-1.561-0.915-2.598c0-1.02,0.305-1.871,0.915-2.551s1.374-1.02,2.291-1.02
			c0.792,0,1.502,0.326,2.131,0.979V558.646z M794.632,562.026c0,0.652,0.174,1.184,0.522,1.592c0.359,0.414,0.811,0.623,1.355,0.623
			c0.582,0,1.054-0.201,1.411-0.602c0.358-0.414,0.539-0.941,0.539-1.578c0-0.639-0.181-1.164-0.539-1.58
			c-0.357-0.404-0.823-0.607-1.396-0.607c-0.54,0-0.991,0.205-1.355,0.615C794.811,560.903,794.632,561.417,794.632,562.026z"/>
		<path fill="#B2B2B2" d="M802.601,556.155v9.293h-1.571v-9.293H802.601z"/>
		<path fill="#B2B2B2" d="M803.406,564.487c0-0.262,0.096-0.486,0.286-0.678c0.191-0.189,0.419-0.285,0.685-0.285
			s0.494,0.096,0.685,0.285c0.191,0.191,0.287,0.42,0.287,0.686c0,0.27-0.096,0.5-0.287,0.691c-0.187,0.186-0.414,0.279-0.685,0.279
			c-0.275,0-0.506-0.094-0.69-0.279C803.498,564.999,803.406,564.767,803.406,564.487z"/>
		<path fill="#B2B2B2" d="M805.908,556.175c0-0.277,0.1-0.514,0.301-0.713c0.2-0.199,0.439-0.301,0.72-0.301
			c0.283,0,0.526,0.102,0.726,0.301c0.2,0.195,0.3,0.434,0.3,0.719s-0.1,0.525-0.3,0.727c-0.196,0.201-0.435,0.301-0.719,0.301
			c-0.285,0-0.526-0.1-0.727-0.301C806.008,556.706,805.908,556.462,805.908,556.175z M807.717,558.646v6.803h-1.57v-6.803H807.717z"
			/>
		<path fill="#B2B2B2" d="M812.945,559.806l-1.297,0.689c-0.206-0.412-0.459-0.621-0.763-0.621c-0.145,0-0.268,0.049-0.37,0.145
			c-0.103,0.094-0.154,0.217-0.154,0.365c0,0.26,0.304,0.52,0.909,0.775c0.833,0.357,1.395,0.688,1.683,0.99s0.434,0.709,0.434,1.221
			c0,0.656-0.243,1.205-0.728,1.646c-0.469,0.418-1.038,0.627-1.704,0.627c-1.141,0-1.947-0.557-2.423-1.668l1.34-0.623
			c0.187,0.326,0.329,0.533,0.427,0.623c0.191,0.176,0.419,0.266,0.685,0.266c0.531,0,0.796-0.242,0.796-0.727
			c0-0.279-0.205-0.541-0.614-0.783c-0.158-0.078-0.315-0.156-0.474-0.23c-0.16-0.074-0.32-0.15-0.482-0.23
			c-0.457-0.225-0.778-0.447-0.965-0.67c-0.236-0.285-0.355-0.65-0.355-1.098c0-0.592,0.202-1.08,0.607-1.467
			c0.413-0.387,0.917-0.58,1.508-0.58C811.875,558.456,812.522,558.905,812.945,559.806z"/>
		<path fill="#B2B2B2" d="M754.849,556.272l1.09,0.418c-0.381,0.912-0.649,1.752-0.802,2.525c-0.076,0.391-0.134,0.803-0.173,1.234
			c-0.037,0.43-0.058,0.9-0.058,1.41c0,0.516,0.021,0.986,0.058,1.418c0.039,0.432,0.097,0.842,0.173,1.234
			c0.15,0.768,0.417,1.607,0.802,2.52l-1.09,0.418c-0.764-1.594-1.147-3.457-1.147-5.59
			C753.701,559.731,754.085,557.866,754.849,556.272z"/>
		<path fill="#B2B2B2" d="M815.191,567.491l-1.09-0.42c0.385-0.914,0.651-1.752,0.803-2.52c0.157-0.77,0.234-1.652,0.234-2.652
			c0-0.99-0.077-1.873-0.234-2.645c-0.153-0.773-0.422-1.615-0.803-2.525l1.09-0.42c0.763,1.596,1.143,3.461,1.143,5.59
			C816.334,564.03,815.954,565.894,815.191,567.491z"/>
	</g>
	<g>
		<path fill="#B2B2B2" d="M628.656,554.99c0,0-0.76,2.174-1.105,2.587c-0.344,0.415,1.416,0.346,1.658,0.173
			C629.45,557.577,628.656,554.99,628.656,554.99z"/>
		<path fill="#B2B2B2" d="M640.562,554.369c0,0,0.309,2.104,0.792,2.622c0.484,0.519-1.069,0.553-1.415,0.586
			C639.595,557.612,640.562,554.369,640.562,554.369z"/>
		<path fill="#B2B2B2" d="M630.76,561.546c0,0-0.275,1.795-0.102,2.104c0.172,0.311,1.138,0.483,1.656,0.346
			C632.831,563.857,630.76,561.546,630.76,561.546z"/>
		<path fill="#B2B2B2" d="M638.56,561.512c0,0,0.241,1.932-0.033,2.174c-0.277,0.242-1.484,0.483-1.624,0.622
			C636.767,564.445,638.56,561.512,638.56,561.512z"/>
		<path fill="#B2B2B2" d="M632.384,564.237c0,0-0.242,1.553-0.104,1.898c0.139,0.346,0.966,0.62,1.277,0.62
			C633.867,566.756,632.384,564.237,632.384,564.237z"/>
		<path fill="#B2B2B2" d="M636.902,564.308c0,0,0.278,1.518,0.347,1.793c0.069,0.276-1.347,0.76-1.556,0.76
			C635.488,566.86,636.731,564.237,636.902,564.308z"/>
		<path fill="#B2B2B2" d="M628.656,553.541c0.412-0.18,1.07,0.736,2.002,0.725c2.587-0.034,2.725-1.967,3.864-1.967
			c1.139,0,1.864,1.967,3.416,1.933c1.553-0.035,2.347-1.277,2.657-0.898c0.311,0.38-0.794,5.764-2.036,8.179
			c-1.231,2.395-3.104,5.106-3.036,6.522c0.069,1.413,1.69,3.07,1.553,3.691c-0.139,0.621-0.586-0.173-2.347-0.034
			c-1.759,0.137-1.656,0.62-2.174,0.518c-0.518-0.104,1.146-2.45,1.173-4.245c0.035-2.346-2.828-5.969-3.451-7.142
			C629.657,559.648,628.104,553.782,628.656,553.541z"/>
	</g>';

	$svg .=  '</svg>';
	
	// Make a new file for each page
	$fp = fopen('page-'.($i+1).'-week-'.$week_number.'.svg', 'w');
	fwrite($fp, $svg);
	fclose($fp);
	
	$week_number++;
	$start_date = strtotime("+1 week",$start_date);
}

$svg = '';
$svg .= '<?xml version="1.0" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">'."\n";

$svg .=  '<svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="297mm" height="210mm" >'."\n";

// Front page for the week:
$svg .= '<text fill="#00000"  x="158mm" y="50.4mm" font-family="\'Futura-Medium\'" font-size="48">#WEEKNOTES</text>';
$svg .= '<text text-anchor="middle" fill="#00000" y="60mm" x="216mm" font-family="\'Futura-Medium\'" font-size="12">Q'.$quarter.' '.($week_number-13).'-'.$week_number.' </text>';

// Backpage lines
$margin = 12;
$lines = 17;
for($j=0;$j<$lines;$j++){
	$y = $margin + $j*((210-$margin)/$lines);
	$svg .= '<line x1="12mm" x2="140mm" y1="'.$y.'mm" y2="'.$y.'mm" fill="none" stroke="#B2B2B2" stroke-width="0.25" stroke-miterlimit="10" />';
}


$svg .=  '</svg>';

// Make a new file for each page
$fp = fopen('page-cover-week.svg', 'w');
fwrite($fp, $svg);
fclose($fp);


function makeWeek($day){
	$svg = '';
	for($i=0;$i<7;$i++){
		$svg .= makeBox($i,$day);
		$day += 24*60*60;
	}
	return $svg;
}

function makeBox($count, $date_time){
	$svg = '';
	$day_number   = date('j',$date_time);
	$box_size   = 8.6071428571;
	
	$counter_x = $count;
	$counter_y = 1;
	
	$offset_dot = 2;
	
	$offset_x = 75;
	$offset_y = 0;
	$offset_dot = 2;
	
	$svg .= '<g>';

	$day_of_week = date('w',$date_time);
	$line_color = false;
	// Weekend Check
	if ($day_of_week == 0 || $day_of_week == 6){ $line_color = '#DCDDDE'; }
	// Other Month Check
	//if ($month_number != date('n',$date_time)){  $line_color = '#939598'; }

	// Lines and dot for weekends and other months
	if ($line_color != false){
		for($i=1;$i<8;$i++){
			$svg .= '<line x1="'.($offset_x+($counter_x*$box_size)+(($box_size/8)*$i)).'mm" y1="'.($offset_y+($counter_y*$box_size)).'mm" x2="'.($offset_x+($counter_x*$box_size)+$box_size).'mm" y2="'.($offset_y+($counter_y*$box_size)+$box_size-(($box_size/8)*$i)).'mm" stroke="'.$line_color.'" stroke-width="0.25" stroke-miterlimit="10"  />'."\n";
		}
		$svg .= '<line x1="'.($offset_x+($counter_x*$box_size)).'mm" y1="'.($offset_y+($counter_y*$box_size)).'mm" x2="'.($offset_x+($counter_x*$box_size)+$box_size).'mm" y2="'.($offset_y+($counter_y*$box_size)+$box_size).'mm" stroke="'.$line_color.'" stroke-width="0.25" stroke-miterlimit="10"  />'."\n";
		for($i=1;$i<8;$i++){
			$svg .= '<line x1="'.($offset_x+($counter_x*$box_size)).'mm" y1="'.($offset_y+($counter_y*$box_size)+(($box_size/8)*$i)).'mm" x2="'.($offset_x+($counter_x*$box_size)+$box_size-(($box_size/8)*$i)).'mm" y2="'.($offset_y+($counter_y*$box_size)+$box_size).'mm" stroke="'.$line_color.'" stroke-width="0.25" stroke-miterlimit="10"  />'."\n";
		}
		$svg .= '<circle cx="'.($offset_x+($counter_x*$box_size)+$offset_dot).'mm" cy="'.($offset_y+($counter_y*$box_size)+$offset_dot).'mm" r="1.442mm" fill="#FFFFFF" stroke="none" stroke-miterlimit="10" />'."\n";
	}
	
	// day number
	$x_text_offset = .6;
	if ($day_number < 10){ $x_text_offset = .3; }
	$svg .= '<text x="'.($offset_x+($counter_x*$box_size)+$offset_dot-($offset_dot*$x_text_offset)).'mm"  y="'.($offset_y+($counter_y*$box_size)+$offset_dot+($offset_dot*.4)).'mm" fill="#939598" font-family="\'Futura-Medium\'" font-size="6">'.$day_number.'</text>'."\n";
	
	// Box to hide edges
	$svg .= '<rect x="'.($offset_x+($counter_x*$box_size)).'mm" y="'.($offset_y+($counter_y*$box_size)).'mm" fill="none" stroke="#000000" stroke-width="0.25" stroke-miterlimit="10" width="'.$box_size.'mm" height="'.$box_size.'mm"/>'."\n";
	
	$svg .= '</g>';
	
	return $svg;
}


?>
